# 前端API整合修正摘要

## 已修正的問題

### 1. API響應格式修正
**問題**: Store中的代碼期望舊的包裝格式 `response.data.success` 和 `response.data.data`  
**解決**: 修改為直接使用後端響應格式 `response.data`

### 2. 分頁參數修正  
**問題**: API調用使用 `limit` 參數，但後端期望 `pageSize`  
**解決**: 統一改為使用 `pageSize` 參數

### 3. 分頁響應處理修正
**問題**: 前端期望 `data.total`, `data.page`，但後端返回 `totalCount`, `pageNumber`  
**解決**: 修改為使用正確的屬性名稱

## 修正的文件

### AnnouncementStore (/stores/modules/announcement.ts)
- ✅ `fetchAnnouncements` - 修正API參數和響應處理
- ✅ `fetchAnnouncementById` - 修正響應格式，後端已自動增加瀏覽次數
- ✅ `createAnnouncement` - 修正響應格式
- ✅ `updateAnnouncement` - 簡化為重新獲取資料
- ✅ `fetchHomeAnnouncements` - 改用 `getActiveAnnouncements` API

### BannerStore (/stores/modules/banner.ts)  
- ✅ `fetchBanners` - 修正API參數和響應處理
- ✅ `fetchCarouselBanners` - 改用 `getActiveBanners` API

### CouponStore (/stores/modules/coupon.ts)
- ✅ `fetchCoupons` - 修正API參數和響應處理  
- ✅ `fetchAvailableCoupons` - 改用 `getActiveCoupons` API，加入手動篩選

## 前端狀態檢查

### 前端開發服務器
- ✅ 正在運行於 http://localhost:5173

### 後端API服務器  
- ⚠️ 需要啟動 (dotnet run)
- ⚠️ WSL環境缺少.NET SDK

## 測試建議

### 1. 在Windows環境中啟動後端API
```bash
cd C:\Users\a0927\source\repos\FUEN42_G2_MVC08190133\FUEN42_G2_frontend
dotnet run
```

### 2. 檢查前端頁面
- 訪問 http://localhost:5173
- 檢查首頁是否正確顯示公告和廣告
- 檢查瀏覽器開發者工具的錯誤訊息

### 3. 測試API連接  
```bash
# 健康檢查
curl http://localhost:5099/health

# 測試API端點  
curl http://localhost:5099/api/announcements
curl http://localhost:5099/api/banners  
curl http://localhost:5099/api/coupons
```

### 4. 檢查前端組件
- 首頁公告區塊是否顯示
- 廣告輪播是否正常
- 優惠券頁面是否可用

## 潛在問題

### 1. 資料庫連接
- 需要確認 ConnectionString 設定正確
- 需要有測試資料

### 2. CORS設定  
- 已配置允許 http://localhost:5173
- 應該可以正常跨域請求

### 3. 錯誤處理
- API調用失敗時前端應該顯示友好的錯誤訊息
- Loading狀態應該正確顯示

## 下一步

1. **啟動後端服務** - 必須先有API服務器
2. **測試前端連接** - 檢查實際資料載入
3. **除錯API調用** - 查看Network面板的請求狀況  
4. **測試CRUD操作** - 確認增刪改查功能
5. **優化用戶體驗** - 加入更好的載入動畫和錯誤處理

---
**修正時間**: 2025-08-19  
**修正範圍**: 前端Stores的API整合